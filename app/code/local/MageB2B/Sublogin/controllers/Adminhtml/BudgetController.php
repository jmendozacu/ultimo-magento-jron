<?php

class
MageB2B_Sublogin_Adminhtml_BudgetController
extends
Mage_Adminhtml_Controller_Action
{

protected
function
_initAction()
{
$this->loadLayout()
->_setActiveMenu('sublogin/budget')
;
return
$this;
}

public
function
indexAction()
{
$this->_initAction();
$this->_addContent($this->getLayout()->createBlock('sublogin/admin_budget'));
$this->renderLayout();
}
public
function
gridAction()
{
$_ce376578098cf70af7021fca72fe4e15a4a98365
=
$this->getRequest()->getParam('budget_id');
$_384d479d3c396afbfb7e832d2d450608e3145d55
=
Mage::getModel('sublogin/budget')->load($_ce376578098cf70af7021fca72fe4e15a4a98365);
Mage::register('sublogin_budget_model',
$_384d479d3c396afbfb7e832d2d450608e3145d55);
echo
Mage::getSingleton('core/layout')->createBlock('sublogin/admin_budget_grid')->toHtml();
}
public
function
massDeleteAction()
{
$_8ebc20c2a00ee934fb32564781e5f3b40d3bf7af
=
$this->getRequest()->getParam('budget_ids');
if(!is_array($_8ebc20c2a00ee934fb32564781e5f3b40d3bf7af))
{
Mage::getSingleton('adminhtml/session')->addError(Mage::helper('sublogin')->__('Please select budget(s).'));
}
else
{
try
{
$_61f2cfacfa3d0592869c10e52822fe136957a710
=
Mage::getModel('sublogin/budget');
foreach
($_8ebc20c2a00ee934fb32564781e5f3b40d3bf7af
as
$_ce376578098cf70af7021fca72fe4e15a4a98365)
{
$_61f2cfacfa3d0592869c10e52822fe136957a710->load($_ce376578098cf70af7021fca72fe4e15a4a98365)->delete();
}
Mage::getSingleton('adminhtml/session')->addSuccess(Mage::helper('adminhtml')->__(
'Total of %d record(s) were deleted.',
count($_8ebc20c2a00ee934fb32564781e5f3b40d3bf7af)
));
}
catch
(Exception
$_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5)
{
Mage::getSingleton('adminhtml/session')->addError($_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5->getMessage());
}
}
$this->_redirect('*/*/index');
}

public
function
editAction()
{
$_ce376578098cf70af7021fca72fe4e15a4a98365
=
$this->getRequest()->getParam('id');
$_61f2cfacfa3d0592869c10e52822fe136957a710
=
Mage::getModel('sublogin/budget');
if
($_61f2cfacfa3d0592869c10e52822fe136957a710->load($_ce376578098cf70af7021fca72fe4e15a4a98365)
||
$_ce376578098cf70af7021fca72fe4e15a4a98365
==
0)
{
if
($_ce376578098cf70af7021fca72fe4e15a4a98365
==
0)
{
$_61f2cfacfa3d0592869c10e52822fe136957a710->setData(Mage::getSingleton('adminhtml/session')->getBudgetData());
Mage::getSingleton('adminhtml/session')->setBudgetData(null);
}
Mage::register('budget_data',
$_61f2cfacfa3d0592869c10e52822fe136957a710);
$this->_initAction();
$this
->_addContent($this->getLayout()->createBlock('sublogin/admin_budget_edit'))
->_addLeft($this->getLayout()->createBlock('sublogin/admin_budget_edit_tabs'))
;
$this->renderLayout();
}
else
{
Mage::getSingleton('adminhtml/session')->addError(Mage::helper('sublogin')->__('Item does not exist'));
$this->_redirect('*/*/');
}
}
public
function
newAction()
{
$this->_forward('edit');
}
protected
function
_manipulateDataBasedonBudgetType($_7e7eef674650ac545be8b71d34aed41774cfbe08)
{
return
Mage::helper('sublogin')->manipulateDataBasedonBudgetType($_7e7eef674650ac545be8b71d34aed41774cfbe08);
}
public
function
saveAction()
{
if
(!$this->getRequest()->getPost())
$this->_redirect('*/*/');
$_ce376578098cf70af7021fca72fe4e15a4a98365
=
$this->getRequest()->getParam('budget_id');
$_384d479d3c396afbfb7e832d2d450608e3145d55
=
Mage::getModel('sublogin/budget')->load($_ce376578098cf70af7021fca72fe4e15a4a98365);
$_7e7eef674650ac545be8b71d34aed41774cfbe08
=
$this->getRequest()->getPost();
try
{
$_7e7eef674650ac545be8b71d34aed41774cfbe08
=
$this->_manipulateDataBasedonBudgetType($_7e7eef674650ac545be8b71d34aed41774cfbe08);
$_384d479d3c396afbfb7e832d2d450608e3145d55->setData($_7e7eef674650ac545be8b71d34aed41774cfbe08);

if
(!$_384d479d3c396afbfb7e832d2d450608e3145d55->checkIsUnique())
{
$_1035488f1a8670e7d7b24553a97215dba4b79a2c
=
Mage::helper('sublogin')->__('Same configuration already exist for this sublogin: Year: "%s", Month: "%s" and Day: "%s"',
$_384d479d3c396afbfb7e832d2d450608e3145d55->getYear(),
$_384d479d3c396afbfb7e832d2d450608e3145d55->getMonth(),
$_384d479d3c396afbfb7e832d2d450608e3145d55->getDay());
throw
new
Exception($_1035488f1a8670e7d7b24553a97215dba4b79a2c);
}
$_384d479d3c396afbfb7e832d2d450608e3145d55->save();
Mage::getSingleton('adminhtml/session')->addSuccess(Mage::helper('adminhtml')->__('Item was successfully saved'));
if
($this->getRequest()->getParam('back'))
{
$this->_redirect('*/*/edit',
array('id'=>$_384d479d3c396afbfb7e832d2d450608e3145d55->getId()));
return;
}
}
catch
(Exception
$_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5)
{
Mage::logException($_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5);
Mage::getSingleton('adminhtml/session')->addError($_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5->getMessage());
if
($_ce376578098cf70af7021fca72fe4e15a4a98365)
{
$this->_redirect('*/*/edit',
array('id'=>$_ce376578098cf70af7021fca72fe4e15a4a98365));
}
else
{
Mage::getSingleton('adminhtml/session')->setBudgetData($_7e7eef674650ac545be8b71d34aed41774cfbe08);
$this->_redirect('*/*/new');
}
return;
}
$this->_redirect('*/*/');
}
public
function
deleteAction()
{
if
($this->getRequest()->getParam('id')
>
0)
{
try
{
$_61f2cfacfa3d0592869c10e52822fe136957a710
=
Mage::getModel('sublogin/budget')->load($this->getRequest()->getParam('id'));
$_61f2cfacfa3d0592869c10e52822fe136957a710->delete();
Mage::getSingleton('adminhtml/session')->addSuccess(Mage::helper('adminhtml')->__('Item was successfully deleted'));
$this->_redirect('*/*/');
}
catch
(Exception
$_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5)
{
Mage::getSingleton('adminhtml/session')->addError($_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5->getMessage());
$this->_redirect('*/*/edit',
array('id'
=>
$this->getRequest()->getParam('id')));
}
}
$this->_redirect('*/*/');
}
}
