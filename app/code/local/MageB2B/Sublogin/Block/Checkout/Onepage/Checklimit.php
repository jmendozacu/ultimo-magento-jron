<?php

class
MageB2B_Sublogin_Block_Checkout_Onepage_Checklimit
extends
Mage_Checkout_Block_Onepage
{
public
function
__construct()
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117
=
Mage::helper('sublogin')->getCurrentSublogin();
if
(!$_4e45fa4f3249d9c3cc1314ed89922593008cf117)
return;

$_3c5f2489ba0fafe03a4e6bebaf9e7a844ca4baf0
=
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getBudgets();
$_32b2e481a5859263154fef03c2a70136c80b70c5
=
0;
$_f91fa841895e7c0c9cac97516981aeaf85274a78
=
0;
$_454cdfa8488f715b08a33608c9619aba33ea9742
=
date('Y-m-d');
$_31335eb08358ca8bbafb3759294a66d12439bf1e
=
date('Y-m');
$_29f5cef5f16a7e3a19ce9020fb3a2f9ed6dbfb87
=
date('Y');
$_1ac303d1215247958764df83f3e1cd1ff80c9e33
=
1000;
$_42e513359269508d70ccffd9f5921839fc7fa309
=
'';
if
($_3c5f2489ba0fafe03a4e6bebaf9e7a844ca4baf0)
{
foreach
($_3c5f2489ba0fafe03a4e6bebaf9e7a844ca4baf0
as
$_5dd72508a2dea2c923fa4b713fab0d715770184b)
{
if
($_454cdfa8488f715b08a33608c9619aba33ea9742
==
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getYear().'-'.$_5dd72508a2dea2c923fa4b713fab0d715770184b->getMonth().'-'.$_5dd72508a2dea2c923fa4b713fab0d715770184b->getDay())
{
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
>
1)
{
$_42e513359269508d70ccffd9f5921839fc7fa309
=
'day';
$_1ac303d1215247958764df83f3e1cd1ff80c9e33
=
1;
$_32b2e481a5859263154fef03c2a70136c80b70c5
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getPerOrder();
$_f91fa841895e7c0c9cac97516981aeaf85274a78
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getAmount();
}
}
elseif($_31335eb08358ca8bbafb3759294a66d12439bf1e
==
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getYear().'-'.$_5dd72508a2dea2c923fa4b713fab0d715770184b->getMonth())
{
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
>
2)
{
$_42e513359269508d70ccffd9f5921839fc7fa309
=
'month';
$_1ac303d1215247958764df83f3e1cd1ff80c9e33
=
2;
$_32b2e481a5859263154fef03c2a70136c80b70c5
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getPerOrder();
$_f91fa841895e7c0c9cac97516981aeaf85274a78
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getAmount();
}
}
elseif($_29f5cef5f16a7e3a19ce9020fb3a2f9ed6dbfb87
==
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getYear())
{
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
>
3)
{
$_42e513359269508d70ccffd9f5921839fc7fa309
=
'year';
$_1ac303d1215247958764df83f3e1cd1ff80c9e33
=
3;
$_32b2e481a5859263154fef03c2a70136c80b70c5
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getPerOrder();
$_f91fa841895e7c0c9cac97516981aeaf85274a78
=
$_5dd72508a2dea2c923fa4b713fab0d715770184b->getAmount();
}
}
}
}
$_91d27b4a2fa537e72f543badde6e7972801ef1b5
=
Mage::getSingleton('checkout/session');

if
($_32b2e481a5859263154fef03c2a70136c80b70c5
>
0)
{
$_967847c85bd6ed322e4c258e41ff62e99d2ac89f
=
$_91d27b4a2fa537e72f543badde6e7972801ef1b5->getQuote()->getBaseGrandTotal();
if
($_967847c85bd6ed322e4c258e41ff62e99d2ac89f
>
$_32b2e481a5859263154fef03c2a70136c80b70c5)
{
$_91d27b4a2fa537e72f543badde6e7972801ef1b5->addError(Mage::helper('sublogin')->__('You are not allowed to place order which has total greater than %s',
Mage::helper('core')->formatCurrency($_32b2e481a5859263154fef03c2a70136c80b70c5)));
$_7e23d5ac854af6c14a773f4575e12a0e2b975da8
=
Mage::getUrl('checkout/cart');
Mage::app()->getFrontController()->getResponse()->setRedirect($_7e23d5ac854af6c14a773f4575e12a0e2b975da8);
return;
}
}

if
($_f91fa841895e7c0c9cac97516981aeaf85274a78)
{





$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f
=
null;
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
==
1)
{
$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f
=
date("Y-m-d");
}
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
==
2)
{
$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f
=
date("Y-m-d",
mktime(0,
0,
0,
$_31335eb08358ca8bbafb3759294a66d12439bf1e,
1,
$_29f5cef5f16a7e3a19ce9020fb3a2f9ed6dbfb87));
}
if
($_1ac303d1215247958764df83f3e1cd1ff80c9e33
==
3)
{
$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f
=
date("Y-m-d",
mktime(0,
0,
0,
1,
1,
$_29f5cef5f16a7e3a19ce9020fb3a2f9ed6dbfb87));
}
if(!$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f){
return;
}
$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f
.=
' 00:00:00';
$_92793d8bbb72967d9093534e8cfce65e0beef9c1
=
Mage::getResourceModel('reports/customer_totals_collection')

->addAttributeToFilter('customer_email',
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail())
->addAttributeToFilter('state',
array('neq'=>Mage_Sales_Model_Order::STATE_CANCELED))
->addAttributeToFilter('created_at',
array('from'
=>
$_c1bcf15e28a586a7a8a79d08d9fbb3070c3e265f,
'to'
=>
now(),
'datetime'
=>
true))
;
$_1a443ee4a78ed34bc6b903c2ca0fe52d2cce5226
=
0;
foreach($_92793d8bbb72967d9093534e8cfce65e0beef9c1
as
$_ebd3a55faf668337347167324a8ff6e7a6d5d63e){
$_1a443ee4a78ed34bc6b903c2ca0fe52d2cce5226
+=
$_ebd3a55faf668337347167324a8ff6e7a6d5d63e->getBaseGrandTotal();
}

$_967847c85bd6ed322e4c258e41ff62e99d2ac89f
=
$_91d27b4a2fa537e72f543badde6e7972801ef1b5->getQuote()->getBaseGrandTotal();

if
(
($_1a443ee4a78ed34bc6b903c2ca0fe52d2cce5226+$_967847c85bd6ed322e4c258e41ff62e99d2ac89f)
>
$_f91fa841895e7c0c9cac97516981aeaf85274a78)
{
$_b4f1265d04c1b432353420a72c24a4986f14c6a2
=
$_f91fa841895e7c0c9cac97516981aeaf85274a78
-
$_1a443ee4a78ed34bc6b903c2ca0fe52d2cce5226;
$_91d27b4a2fa537e72f543badde6e7972801ef1b5->addError(Mage::helper('sublogin')->__('You can not proceed as your purchase limit %s for this %s is reached.',
Mage::helper('core')->formatCurrency($_f91fa841895e7c0c9cac97516981aeaf85274a78),
$_42e513359269508d70ccffd9f5921839fc7fa309));
if
($_b4f1265d04c1b432353420a72c24a4986f14c6a2
>
0)
{
$_91d27b4a2fa537e72f543badde6e7972801ef1b5->addError(Mage::helper('sublogin')->__('You can continue with this order if your cart total is maximum upto %s.',
Mage::helper('core')->formatCurrency($_b4f1265d04c1b432353420a72c24a4986f14c6a2)));
}
$_7e23d5ac854af6c14a773f4575e12a0e2b975da8
=
Mage::getUrl('checkout/cart');
Mage::app()->getFrontController()->getResponse()->setRedirect($_7e23d5ac854af6c14a773f4575e12a0e2b975da8);
return;
}
}
}
}
