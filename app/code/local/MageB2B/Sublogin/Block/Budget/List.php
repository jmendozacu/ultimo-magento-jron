<?php

class
MageB2B_Sublogin_Block_Budget_List
extends
Mage_Core_Block_Template
{
protected
$_subloginCollection;
protected
$_customer;
protected
function
_construct()
{
$this->_customer
=
Mage::getSingleton('customer/session')->getCustomer();
$this->_subloginCollection
=
Mage::getModel('sublogin/budget')->getCollection();
$this->_subloginCollection->getSelect()->join(
array('sublogin'=>$this->_subloginCollection->getTable('sublogin/sublogin')),
'main_table.sublogin_id = sublogin.id AND sublogin.entity_id = '.$this->_customer->getId(),
array('sublogin.email')
);
$this->_subloginCollection->getSelect()->order("budget_id desc");
}

public
function
getCollection()
{
return
$this->_subloginCollection;
}

public
function
getCustomer()
{
return
$this->_customer;
}

public
function
getSortlink($_3f69c14e858b5c1df34d113331775fb073451b81,
$_3c234514969b97ab3afdf6028bbc1c46a494841f)
{
$_eb03ffe1dd98957980d0e5008d2a33cefda56ec3
=
'desc';
$_11d9530e1024e0d869f1e86f8e94f301f6ea2ef2
=
'not-sort';
if
($_3f69c14e858b5c1df34d113331775fb073451b81
==
$this->getRequest()->getParam('sort'))
{
$_eb03ffe1dd98957980d0e5008d2a33cefda56ec3
=
$this->getRequest()->getParam('direction')=='asc'?'desc':'asc';
$_11d9530e1024e0d869f1e86f8e94f301f6ea2ef2
=
'sort-arrow-'.(($this->getRequest()->getParam('direction')=='asc')?'asc':'desc');
}
return
'<a class="'.$_11d9530e1024e0d869f1e86f8e94f301f6ea2ef2.'" href="'.Mage::getUrl('sublogin/frontend/index/',
array('sort'=>$_3f69c14e858b5c1df34d113331775fb073451b81,
'direction'=>$_eb03ffe1dd98957980d0e5008d2a33cefda56ec3)).'">'.
'<span class="sort-title">'.$_3c234514969b97ab3afdf6028bbc1c46a494841f.'</span></a>';
}

public
function
dateFormat($_f0c57a04a51d1d900c8d28a111ab8f340a17465b)
{
if
(!$_f0c57a04a51d1d900c8d28a111ab8f340a17465b)
{
return
'';
}
return
$this->formatDate($_f0c57a04a51d1d900c8d28a111ab8f340a17465b,
Mage_Core_Model_Locale::FORMAT_TYPE_SHORT);
}

public
function
accessNewSubloginButton()
{

if
(!Mage::getSingleton('customer/session')->getSubloginEmail())
{
if
($this->getCustomer()->getCanCreateSublogins())
{
if
($this->getCustomer()->getMaxNumberSublogins()
==
0)
{
return
true;
}
else
if
($this->getCustomer()->getMaxNumberSublogins()
>
$this->getCollection()->getSize())
{
return
true;
}
else
{
return
false;
}
}
else
{
return
false;
}
}

else
if
(Mage::helper('sublogin')->getCurrentSublogin())
{
if
(Mage::helper('sublogin')->getCurrentSublogin()->getCreateSublogins())
{
if
($this->getCustomer()->getMaxNumberSublogins()
==
0)
{
return
true;
}
else
if
($this->getCustomer()->getMaxNumberSublogins()
>
$this->getCollection()->getSize())
{
return
true;
}
else
{
return
false;
}
}
return
false;
}
else
{
return
false;
}
}

public
function
noticeOnMaxSublogin()
{
$_5db2653436e305bf895ca3b3e05b218e34b8e0cd
=
(int)
$this->getCustomer()->getMaxNumberSublogins();
if
($_5db2653436e305bf895ca3b3e05b218e34b8e0cd
!=
0
&&
$_5db2653436e305bf895ca3b3e05b218e34b8e0cd
==
$this->getCollection()->getSize())
{
return
true;
}
return
false;
}
}
